<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/defaultLL.css">
		<link rel="stylesheet" href="css/indexLL.css">
		<link rel="stylesheet" href="css/manager_home.css">
		<link rel="stylesheet" href="css/common.css">
		<link rel="stylesheet" href="css/retread.css">
	</head>
	<body>
		<div style="background-color: #fff;width: 1280px;height: 1024px;">
			<div class="gly_sy" style="margin: 0px;">
				<div style="margin: 20px auto;width: 200px;">
					<a style="color: #333;font-size: 25px;">请输入起始格口号</a>
					<div id="startCell" style="width: 200px;height: 50px;background-color: #F3F3F3;font-size: 25px;text-align: center;line-height: 50px;" class="tappable" placeholder="起始格口号" data-action="startCell"/></div>
					<a style="color: #333;font-size: 25px;">请输入结束格口号</a>
					<div id="endCell" style="width: 200px;height: 50px;background-color: #F3F3F3;font-size: 25px;text-align: center;line-height: 50px;" class="tappable"  placeholder="结束格口号" data-action="endCell" /></div>
				</div>

				<a class="manager_btn tappable" data-action="open">开门</a>
				<a class="manager_btn tappable" data-action="openlight">开灯</a>
				<a class="manager_btn tappable" data-action="closelight">关灯</a>
				<a class="manager_btn tappable" data-action="reboot">重启</a>
			</div>	
			<div id="keyboardArea" style="width: 1280px;display: none;" class="keyboardArea tappable" data-action="clearKeyCss">
				<ul class="keyboardul" style="width: 900px;" id="keyboardul">
					<li class="key tappable" data-action="keyboard" data-value="1">1</li>
					<li class="key tappable" data-action="keyboard" data-value="2">2</li>
					<li class="key tappable" data-action="keyboard" data-value="3">3</li>
					<li class="key tappable" data-action="keyboard" data-value="4">4</li>
					<li class="key tappable" data-action="keyboard" data-value="5">5</li>
					<li class="key tappable" data-action="keyboard" data-value="6">6</li>
					<li class="key tappable" data-action="keyboard" data-value="7">7</li>
					<li class="key tappable" data-action="keyboard" data-value="8">8</li>
					<li class="key tappable" data-action="keyboard" data-value="9">9</li>
					<li class="key tappable" data-action="keyboard" data-value="0">0</li>
	
					<li class="key tappable" data-action="keyboard" data-value="Q">Q</li>
					<li class="key tappable" data-action="keyboard" data-value="W">W</li>
					<li class="key tappable" data-action="keyboard" data-value="E">E</li>
					<li class="key tappable" data-action="keyboard" data-value="R">R</li>
					<li class="key tappable" data-action="keyboard" data-value="T">T</li>
					<li class="key tappable" data-action="keyboard" data-value="Y">Y</li>
					<li class="key tappable" data-action="keyboard" data-value="U">U</li>
					<li class="key tappable" data-action="keyboard" data-value="I">I</li>
					<li class="key tappable" data-action="keyboard" data-value="O">O</li>
					<li class="key tappable" data-action="keyboard" data-value="P">P</li>
					<li class="key tappable" data-action="keyboard" data-value="A">A</li>
					<li class="key tappable" data-action="keyboard" data-value="S">S</li>
					<li class="key tappable" data-action="keyboard" data-value="D">D</li>
					<li class="key tappable" data-action="keyboard" data-value="F">F</li>
					<li class="key tappable" data-action="keyboard" data-value="G">G</li>
					<li class="key tappable" data-action="keyboard" data-value="H">H</li>
					<li class="key tappable" data-action="keyboard" data-value="J">J</li>
					<li class="key tappable" data-action="keyboard" data-value="K">K</li>
					<li class="key tappable" data-action="keyboard" data-value="L">L</li>
					<li class="key tappable" data-action="keyboard" data-value="backspace">
						<div class="backspace1"></div>
						<div class="backspace2">x</div>
					</li>//退格
					<li style="visibility: hidden;"></li>
					<li class="key tappable" data-action="keyboard" data-value="Z">Z</li>
					<li class="key tappable" data-action="keyboard" data-value="X">X</li>
					<li class="key tappable" data-action="keyboard" data-value="C">C</li>
					<li class="key tappable" data-action="keyboard" data-value="V">V</li>
					<li class="key tappable" data-action="keyboard" data-value="B">B</li>
					<li class="key tappable" data-action="keyboard" data-value="N">N</li>
					<li class="key tappable" data-action="keyboard" data-value="M">M</li>
					<li style="background:#4C5B78 url(img/key_up.png) no-repeat center;" class="key tappable" data-action="keyboard" data-value="packUp"></li>//收起键盘
					<li style="visibility: hidden;"></li>
				</ul>
			</div>
			<div class="return_btn tappable" style="bottom: 60px; right: 60px;position: fixed;" data-action="back">返回</div>
		</div>
		
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>
		<script src="js/jquery.js" type="text/javascript"></script>
		<script src="js/md5.js"></script>
		<script src="js/mui_use.js"></script>
		<script src="js/qrcode.min.js"></script>
		<script src="js/utilLL.js"></script>
		<script src="js/globals.js"></script>
		<script src="js/constructors.js"></script>
		<script src="js/public_functionsLL.js"></script>
		<script src="js/keyboard.js"></script>
		<script>
			(function(_mui, doc) {
				_mui.init({
					beforeback: function() {
						util.helper.closeWebviews(["login.html"]);
					}
				});
				_mui.plusReady(function() {
					plus.webview.close('loginLL.html', 'none');
				});
				
				var selectInput;
				var inputType = "0";
				var keyboardArea = document.getElementById('keyboardArea');
				/*
				 * events bounding
				 */

				doc.addEventListener('tap', function(event) {
					var target = event.target;
					var wrapper = util.dom.getWrapperByClass(target, "tappable");

					if(wrapper) {
						var _document = document,
							_localStorage = localStorage,
							wrapperDataset = wrapper.dataset;

						switch(wrapperDataset.action) {
							case "back":
								mui.back();
								break;
							case "open":
								openDoor();
								break;
							case "reboot":
								public_reboot();
								break;
							case "openlight":
								light_onOff('1');
								break;
							case "closelight":
								light_onOff('0');
								break;
							case "out":
								plus.runtime.quit();
								break;
							case "keyboard":                  
								try {
									event.stopPropagation();
									clearLastKeyCss()					                 
									changeCss(wrapper);							
									keyboardOperation1(selectInput, wrapperDataset.value,inputType);
								} catch(e) {
									alert(e)
									//TODO handle the exception
								}
								break;
							case "startCell":
								selectInput = _document.getElementById("startCell");
								keyboardArea.style.display = 'inline';
								break;
							case "endCell":
								selectInput = _document.getElementById("endCell");
								keyboardArea.style.display = 'inline';
								break;
						}
					}
				});
			}(mui, document));
			
			var nowCell;
			var endCell;
			function openDoor(){
				var startCell = document.getElementById('startCell').textContent;
				endCell = document.getElementById('endCell').textContent;
				public_openTake1(startCell);
			}
			
			function public_openTake1(id) {
				nowCell = id;
				var url = 'http://127.0.0.1:18001/open';
				var data = {
					boxid: id
				};
			
				mui.ajaxSettings.beforeSend = function(xhr, setting) {
			
				};
			
				mui.ajax(url, {
					data: data,
					dataType: 'json', //服务器返回json格式数据
					type: 'get', //HTTP请求类型
					timeout: 120000, //超时时间设置为10秒；
					success: function(response) {
						if(nowCell < endCell){
							nowCell++;
							public_openTake1(nowCell);
						}
					},
					error: function(xhr, type, errorThrown) {
						alert("xhr" + xhr + "type" + type + "errorThrown" + errorThrown);
					}
				});
			}
		</script>
	</body>
</html>
